<template>
  <div class="container" v-el:container :class="{light: theme}">
    <div class="navbar">
      <img :src="switchPath" class="toggle" @click="sidebarToggle()" v-cloak v-show="smallMode" alt="Logo" />
      <img src="../../images/icon.svg" class="logo" alt="Logo" />
      <h1 v-cloak>{{ msg("settings") }}</h1>
      <img v-cloak @click="setTheme(!theme)" class="theme-switch" :src="themePath" />
    </div>
    <div class="main">
      <div
        class="categories-block"
        v-click-outside="closesidebar"
        v-show="categoryOpen && !isIframe"
        :class="{smallMode: smallMode === true}"
      >
        <div class="selected-category-orange"></div>
        <category-selector v-for="category of categories" :category="category"></category-selector>

        <a
          class="category category-small"
          style="margin-top: auto"
          href="https://scratchaddons.com/contributors"
          target="_blank"
        >
          <img src="../../images/icons/users.svg" />
          <span v-cloak>{{ msg("credits") }} <img src="../../images/icons/popout.svg" /></span>
        </a>
        <!--
        <div class="category category-small" @click="openReview()">
          <img src="../../images/icons/star.svg" />
          <span v-cloak>{{ msg("review") }}</span>
        </div>
        -->
        <a class="category category-small" href="https://scratchaddons.com/translate" target="_blank">
          <img src="../../images/icons/translate.svg" />
          <span v-cloak>{{ msg("translate") }} <img src="../../images/icons/popout.svg" /></span>
        </a>
        <a
          class="category category-small"
          href="https://scratchaddons.com/feedback/?version={{versionName}}"
          target="_blank"
        >
          <img src="../../images/icons/comment.svg" />
          <span v-cloak>{{ msg("feedback") }} <img src="../../images/icons/popout.svg" /></span>
        </a>
        <div class="category" style="cursor: pointer; margin-top: 12px; margin-bottom: 12px" @click="modalToggle()">
          <img src="../../images/icons/wrench.svg" />
          <span v-cloak>{{ msg("moreSettings") }}</span>
        </div>
      </div>
      <div
        v-show="!isIframe && smallMode === false"
        class="categories-shrink"
        style="display: block !important"
        @click="sidebarToggle()"
      >
        <img src="../../images/icons/left-arrow.svg" :class="{flipped: categoryOpen === (direction() === 'rtl')}" />
      </div>

      <!-- This is a the main menu, where the searchbar and the addon items are located -->
      <div class="addons-block">
        <div class="search-box" :class="{smallMode: smallMode === true}">
          <input type="text" id="searchBox" :placeholder="searchMsg" v-model="searchInputReal" autofocus />
          <button v-show="searchInput === ''" class="search-button"></button>
          <button v-cloak v-else class="search-clear-button" @click="clearSearch()"></button>
        </div>

        <div class="addons-container" v-cloak>
          <template v-for="addon of addonList">
            <div
              id="iframe-fullscreen-suggestion"
              v-if="isIframe && addon.headerAbove && addon.group.id === 'enabled'"
              v-show="searchInput === ''"
            >
              <span>{{ msg("exploreAllAddons", [addonAmt]) }}</span>
              <button class="large-button" @click="openFullSettings()">{{ msg("openFullSettings") }}</button>
            </div>
            <addon-group-header
              v-if="addon.headerAbove"
              :group="addon.group"
              :shown-count="groupShownCount(addon.group)"
              :margin-above="groupMarginAbove(addon.group)"
            ></addon-group-header>
            <addon-body
              :visible="addon.matchesSearch && addon.matchesCategory"
              :addon="addon.manifest"
              :group-id="addon.group.id"
              :group-expanded="addon.group.expanded"
            ></addon-body>
          </template>
        </div>
      </div>
    </div>
    <div v-cloak v-show="isOpen" class="modal">
      <div class="modal-content" v-click-outside="modalClickOutside">
        <div>
          <img @click="modalToggle()" class="close" alt="Logo" src="../../images/icons/close.svg" />
          <h1 class="setting-heading">{{ msg("moreSettings") }}</h1>
        </div>
        <div class="addon-block settings-block">
          <div class="addon-body">
            <div class="addon-topbar">
              <span class="addon-name"
                ><img src="../../images/icons/theme.svg" class="icon-type" /> {{ msg("scratchAddonsTheme") }}
              </span>
            </div>
            <div class="addon-settings">
              <span class="addon-description-full">{{ msg("scratchAddonsThemeDescription") }}</span>
              <div class="addon-setting">
                <div class="filter-selector">
                  <div class="filter-text">{{ msg("theme") }}</div>
                  <div class="filter-options">
                    <div class="filter-option" :class="{'sel': theme === true}" @click="setTheme(true)">
                      {{ msg("light") }}
                    </div>
                    <div class="filter-option" :class="{'sel': theme === false}" @click="setTheme(false)">
                      {{ msg("dark") }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="addon-body">
            <div class="addon-topbar">
              <span class="addon-name"
                ><img src="../../images/icons/import-export.svg" class="icon-type" :class="{'dark': theme === false}" />
                {{ msg("exportAndImportSettings") }}
              </span>
            </div>
            <div class="addon-settings">
              <span class="addon-description-full">{{ msg("exportAndImportSettingsDescription") }}</span>
              <span class="addon-description-full">{{ msg("useBrowserSync") }}</span>
              <div class="addon-setting">
                <div class="filter-selector">
                  <button class="large-button" @click="exportSettings()">{{ msg("export") }}</button>
                </div>
                <div class="filter-selector">
                  <button class="large-button" @click="importSettings()">{{ msg("import") }}</button>
                  <button class="large-button hidden-button" id="confirmImport">{{ msg("confirmImport") }}</button>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="footer">
          <p>
            {{ msg("extensionName") }}
            <a
              href="https://scratchaddons.com/changelog?versionname={{ versionName }}"
              title="{{ msg('changelog') }}"
              target="_blank"
            >
              v{{ version }}</a
            >
          </p>
          <p>
            <a
              href="./licenses.html?libraries=icu-message-formatter,vue,color-picker-web-component,comlink,Sora,fuse"
              target="_blank"
              >{{ msg("libraryCredits") }}</a
            >
          </p>
        </div>
      </div>
    </div>
    <div class="popup" v-cloak v-show="showPopupModal">
      <div class="label">{{ msg("settingsPagePermission", addonToEnable ? addonToEnable.name : "") }}</div>
      <div>
        <button class="large-button" @click="openFullSettings()">{{ msg("openFullSettings") }}</button>
        <button class="large-button" @click="hidePopup()">{{ msg("skipOpenFullSettings") }}</button>
      </div>
    </div>
  </div>
</template>

<style>
  @import url("./style.css");
</style>
